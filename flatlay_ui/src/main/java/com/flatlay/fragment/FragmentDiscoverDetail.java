package com.flatlay.fragment;import android.animation.AnimatorSet;import android.animation.ObjectAnimator;import android.content.Context;import android.content.DialogInterface;import android.content.Intent;import android.graphics.Color;import android.os.Bundle;import android.support.v4.view.ViewPager;import android.text.Editable;import android.text.TextUtils;import android.text.TextWatcher;import android.util.Log;import android.view.KeyEvent;import android.view.LayoutInflater;import android.view.MotionEvent;import android.view.View;import android.view.ViewGroup;import android.view.WindowManager;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import android.view.inputmethod.InputMethodManager;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.EditText;import android.widget.HorizontalScrollView;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.ListView;import android.widget.RelativeLayout;import android.widget.Spinner;import android.widget.TextView;import com.flatlay.BaseFragment;import com.flatlay.KikrApp;import com.flatlay.R;import com.flatlay.activity.HomeActivity;import com.flatlay.activity.ProductDetailWebViewActivity;import com.flatlay.adapter.ProductImageAdapter;import com.flatlay.dialog.ChooseCollectionDialog;import com.flatlay.dialog.CreateAccountDialog;import com.flatlay.dialog.ShareDialog;import com.flatlay.ui.ProductUI;import com.flatlay.utility.FontUtility;import com.flatlay.utility.MyMaterialContentOverflow2;import com.flatlay.utility.MySmallPageIndicator;import com.flatlay.utility.UiUpdate;import com.flatlaylib.api.AddCollectionApi;import com.flatlaylib.api.CartApi;import com.flatlaylib.api.CollectionApi;import com.flatlaylib.api.ProductBasedOnBrandApi;import com.flatlaylib.api.TwoTapApi;import com.flatlaylib.bean.CollectionList;import com.flatlaylib.bean.Product;import com.flatlaylib.bean.ProductChildOption;import com.flatlaylib.bean.ProductMainOption;import com.flatlaylib.bean.ProductRequiredOption;import com.flatlaylib.bean.TwoTapProductDetails;import com.flatlaylib.db.UserPreference;import com.flatlaylib.service.ServiceCallback;import com.flatlaylib.service.ServiceException;import com.flatlaylib.service.res.CartRes;import com.flatlaylib.service.res.CollectionApiRes;import com.flatlaylib.service.res.ProductBasedOnBrandRes;import com.flatlaylib.utils.AlertUtils;import com.flatlaylib.utils.StringUtils;import com.flatlaylib.utils.Syso;import com.google.android.gms.analytics.HitBuilders;import com.google.android.gms.analytics.Tracker;import com.google.gson.Gson;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import java.text.DecimalFormat;import java.util.ArrayList;import java.util.HashMap;import java.util.Iterator;import java.util.List;import java.util.Map;/** * Created by RachelDi on 2/9/18. */public class FragmentDiscoverDetail extends BaseFragment implements View.OnClickListener {    private View mainView;    private MySmallPageIndicator indicator;    private ViewPager productImageView;    private List<String> productMultipleImages = new ArrayList<String>();    private ProductImageAdapter mAdapter;    private Product product;    private final static int MAX_SPINNER_COUNT = 3;    public static final String TAG = "FragmentDiscoverD";    private List<Product> productLists = new ArrayList<Product>();    private ImageView img1, likeIV, reviewIV, checkoutIV, storeIV, shareIV, squareCheck,            cartImg, squareCheck2, cancelImage;    private RelativeLayout parentRL, mainRL, LikeRL, reviewRL, checkoutRL, shareRL, storeRL;    private boolean isFirstTime = true;    private TextView text1, text2, text6, text7, text8, text9, addCollection, likeTV, reviewTV, checkoutTV,            shareTV, storeTV, button1, button2, textOR, brandName, addProducts,            removeproducts, text7_2, collectionName, floatBrand, floatPrice, cancelIcon,            text33, text44, text55, newCollectionName;    private Spinner spinner1;    private int colorIndex = -1;    private int sizeIndex = -1;    private boolean still_processing = true, isLike, isAdd = true, decided = false, isProductExist = true;    private EditText nameYourCollection;    private LinearLayout addCollectionLayout1, addCollectionLayout2, checkLayout, backIconLayout,            cancel_layout1, cancel_layout2;    private ListView choicelist;    private String choice, color, size, quantity, collection_id, postlink, cartid,            finalNewCollectionName;    private ChooseCollectionDialog collectionListDialog;    private long down;    private LinearLayout spinner_layout, productInflaterLayout, scroll_text7;    private HorizontalScrollView productLayout;    private List<Product> products = new ArrayList<Product>();    private MyMaterialContentOverflow2 overflow1;    private static String SHARE_POST_LINK = "Find it @FLATLAY http://flat-lay.com/product/";    private int page = 0;    private RelativeLayout collectionnamelayout;    private Animation shake;    private List<CollectionList> collectionLists;    private int index = 0;    private boolean choseExisitng = false;    private InputMethodManager imm;    private List<TwoTapProductDetails> productDetails = new ArrayList<TwoTapProductDetails>();    private HashMap<Spinner, String> spinnerNameMap = new HashMap<>();    public FragmentDiscoverDetail() {    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {        mainView = inflater.inflate(R.layout.activity_discover_details, container,false);        return mainView;    }    @Override    public void onClick(View view) {        switch (view.getId()) {            case R.id.add_products_button:                if (index == 0) {                    updateListAdd();                } else if (index == 1) {                    updateListRemove();                }                if (!choseExisitng) {                    if (products.size() > 0 && finalNewCollectionName != null) {                        cancel_layout1.setVisibility(View.GONE);                        checkLayout.setVisibility(View.VISIBLE);                        squareCheck.setVisibility(View.VISIBLE);                        squareCheck.setImageResource(R.drawable.square_check);                    } else {                        checkLayout.setVisibility(View.GONE);                        cancel_layout1.setVisibility(View.VISIBLE);                    }                } else {                    cancel_layout1.setVisibility(View.GONE);                    cancel_layout2.setVisibility(View.GONE);                    checkLayout.setVisibility(View.VISIBLE);                    squareCheck2.setVisibility(View.VISIBLE);                    squareCheck2.setImageResource(R.drawable.square_check);                }                break;            case R.id.cancelIcon:                addCollectionLayout2.setVisibility(View.GONE);                addCollectionLayout1.setVisibility(View.VISIBLE);                imm.hideSoftInputFromWindow(nameYourCollection.getApplicationWindowToken(), 0);                overflow1.getFocus();                break;            case R.id.cancelImage:                addCollectionLayout2.setVisibility(View.GONE);                addCollectionLayout1.setVisibility(View.VISIBLE);                addProducts.setText("");                imm.hideSoftInputFromWindow(nameYourCollection.getApplicationWindowToken(), 0);                overflow1.getFocus();                break;            case R.id.backIconLayout:                mContext.onBackPressed();                break;            case R.id.button2:                choseExisitng = true;                cancel_layout2.setVisibility(View.VISIBLE);                checkLayout.setVisibility(View.GONE);                collectionListDialog = new ChooseCollectionDialog(mContext);                collectionListDialog.getWindow().setBackgroundDrawableResource(R.color.real_transparent);                collectionListDialog.show();                choicelist = (ListView) collectionListDialog.findViewById(R.id.collection_listing);                choicelist.setOnItemClickListener(new AdapterView.OnItemClickListener() {                    @Override                    public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {                        TextView textView = (TextView) view.findViewById(R.id.collection_name);                        String text = textView.getText().toString().trim();                        choice = text;                        collectionListDialog.dismiss();                        cancel_layout2.setVisibility(View.GONE);                        cancel_layout1.setVisibility(View.VISIBLE);                        addCollectionLayout1.setVisibility(View.GONE);                        addProducts.setVisibility(View.VISIBLE);                        addCollectionLayout2.setVisibility(View.VISIBLE);                        squareCheck.setVisibility(View.GONE);                        squareCheck2.setVisibility(View.VISIBLE);                        productInflaterLayout.setVisibility(View.VISIBLE);                        nameYourCollection.setVisibility(View.GONE);                        newCollectionName.setVisibility(View.GONE);                        productLayout.setVisibility(View.VISIBLE);                        collectionName.setVisibility(View.VISIBLE);                        collectionName.setText(choice);                        collectionName.setTextColor(Color.WHITE);                        page = 0;                        collection_id = collectionListDialog.geCheckedCollection(i).getId();                        productInflaterLayout.removeAllViews();                        products.clear();                        initProducts();                    }                });                break;        }    }    public void getProducts() {        final ProductBasedOnBrandApi productBasedOnBrandApi =                new ProductBasedOnBrandApi(new ServiceCallback() {                    @Override                    public void handleOnSuccess(Object object) {                        ProductBasedOnBrandRes productBasedOnBrandRes = (ProductBasedOnBrandRes) object;                        List<Product> data = productBasedOnBrandRes.getData();                        products.addAll(data);                        productInflaterLayout.removeAllViews();                        productInflaterLayout.                                addView(new ProductUI(mContext, 200, 200, products, false).getView());                        //IMPORTANT: assume call api one time, we can get 15 products at most                        if (data.size() == 15) {                            page++;                            getProducts();                        }                        index = 0;                        for (int i = 0; i < products.size(); i++) {                            if (products.get(i).getId().equals(product.getId())) {                                index = 1;                                addProducts.setText("Remove Product");                                isAdd = false;                                break;                            }                        }                        if (index == 0)                            addProducts.setText("Add Product");                    }                    @Override                    public void handleOnFailure(ServiceException exception, Object object) {                    }                });        productBasedOnBrandApi.getProductsBasedOnCollectionList                (UserPreference.getInstance().getUserID(), String.valueOf(page), collection_id);        productBasedOnBrandApi.execute();    }    public void initProducts() {        getProducts();        productLayout.scrollTo(0, 0);    }    @Override    public void initUI(Bundle savedInstanceState) {        imm = (InputMethodManager)                mContext.getSystemService(mContext.INPUT_METHOD_SERVICE);        shake = AnimationUtils.loadAnimation(mContext, R.anim.shake);        cartImg = (ImageView) mainView.findViewById(R.id.cartImg);        indicator = (MySmallPageIndicator) mainView.findViewById(R.id.indicator);        productImageView = (ViewPager) mainView.findViewById(R.id.productImageView);        addCollectionLayout1 = (LinearLayout) mainView.findViewById(R.id.add_collection_layout);        cancel_layout1 = (LinearLayout) mainView.findViewById(R.id.cancel_layout1);        cancel_layout2 = (LinearLayout) mainView.findViewById(R.id.cancel_layout2);        checkLayout = (LinearLayout) mainView.findViewById(R.id.square_check_layout);        backIconLayout = (LinearLayout) mainView.findViewById(R.id.backIconLayout);        addCollectionLayout2 = (LinearLayout) mainView.findViewById(R.id.add_collection_layout2);        addCollection = (TextView) mainView.findViewById(R.id.add_collection_text);        addCollection.setTypeface(FontUtility.setMontserratRegular(mContext));        productLayout = (HorizontalScrollView) mainView.findViewById(R.id.productLayout);        productInflaterLayout = (LinearLayout) mainView.findViewById(R.id.productInflaterLayout);        spinner_layout = (LinearLayout) mainView.findViewById(R.id.spinner_layout);        scroll_text7 = (LinearLayout) mainView.findViewById(R.id.scroll_text7);        WindowManager.LayoutParams lp = mContext.getWindow().getAttributes();        mContext.getWindow().setAttributes(lp);        img1 = (ImageView) mainView.findViewById(R.id.img1);        img1.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (isFirstTime)                    startAnimation();            }        });        collectionnamelayout = (RelativeLayout) mainView.findViewById(R.id.collectionnamelayout);        likeIV = (ImageView) mainView.findViewById(R.id.likeIV);        reviewIV = (ImageView) mainView.findViewById(R.id.reviewIV);        checkoutIV = (ImageView) mainView.findViewById(R.id.checkoutIV);        storeIV = (ImageView) mainView.findViewById(R.id.storeIV);        shareIV = (ImageView) mainView.findViewById(R.id.shareIV);        cancelIcon = (TextView) mainView.findViewById(R.id.cancelIcon);        cancelIcon.setTypeface(FontUtility.setMontserratLight(mContext));        cancelImage = (ImageView) mainView.findViewById(R.id.cancelImage);        parentRL = (RelativeLayout) mainView.findViewById(R.id.parentRL);        mainRL = (RelativeLayout) mainView.findViewById(R.id.mainRL);        LikeRL = (RelativeLayout) mainView.findViewById(R.id.likeRL);        reviewRL = (RelativeLayout) mainView.findViewById(R.id.reviewRL);        checkoutRL = (RelativeLayout) mainView.findViewById(R.id.checkoutRL);        shareRL = (RelativeLayout) mainView.findViewById(R.id.shareRL);        storeRL = (RelativeLayout) mainView.findViewById(R.id.storeRL);        likeTV = (TextView) mainView.findViewById(R.id.likeTV);        likeTV.setTypeface(FontUtility.setMontserratLight(mContext));        likeIV.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                switch (motionEvent.getAction()) {                    case MotionEvent.ACTION_DOWN:                        likeTV.setVisibility(View.VISIBLE);                        likeIV.setImageResource(R.drawable.likegreen);                        down = System.currentTimeMillis();                        break;                    case MotionEvent.ACTION_UP:                        likeIV.setImageResource(R.drawable.small_gray_heart);                        likeTV.setVisibility(View.GONE);                        long diff = System.currentTimeMillis() - down;                        if (diff < 150) {                            if (UserPreference.getInstance().getPassword() == "" ||                                    UserPreference.getInstance().getEmail() == "" ||                                    UserPreference.getInstance().getUserName() == "") {                                CreateAccountDialog createAccountDialog =                                        new CreateAccountDialog(mContext);                                createAccountDialog.show();                            } else {                                ((HomeActivity) mContext).likeInspiration(product, new UiUpdate() {                                    @Override                                    public void updateUi() {                                    }                                });                            }                        }                        break;                }                return false;            }        });        reviewTV = (TextView) mainView.findViewById(R.id.reviewTV);        reviewTV.setTypeface(FontUtility.setMontserratLight(mContext));        reviewIV.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                switch (motionEvent.getAction()) {                    case MotionEvent.ACTION_DOWN:                        reviewIV.setImageResource(R.drawable.tealstar);                        reviewTV.setVisibility(View.VISIBLE);                        down = System.currentTimeMillis();                        break;                    case MotionEvent.ACTION_UP:                        reviewIV.setImageResource(R.drawable.small_gray_star);                        reviewTV.setVisibility(View.GONE);                        break;                }                return false;            }        });        checkoutTV = (TextView) mainView.findViewById(R.id.checkoutTV);        checkoutTV.setTypeface(FontUtility.setMontserratLight(mContext));        checkoutIV.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                switch (motionEvent.getAction()) {                    case MotionEvent.ACTION_DOWN:                        checkoutIV.setImageResource(com.flatlay.R.drawable.ic_cart_selected);                        checkoutTV.setVisibility(View.VISIBLE);                        down = System.currentTimeMillis();                        break;                    case MotionEvent.ACTION_UP:                        checkoutIV.setImageResource(com.flatlay.R.drawable.small_gray_cart);                        checkoutTV.setVisibility(View.GONE);                        long diff = System.currentTimeMillis() - down;                        if (diff < 150) {                            overflow1.triggerSlide();                        }                        break;                }                return false;            }        });        shareTV = (TextView) mainView.findViewById(R.id.shareTV);        shareTV.setTypeface(FontUtility.setMontserratLight(mContext));        shareIV.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                switch (motionEvent.getAction()) {                    case MotionEvent.ACTION_DOWN:                        shareIV.setImageResource(R.drawable.sharegreen1);                        shareTV.setVisibility(View.VISIBLE);                        down = System.currentTimeMillis();                        break;                    case MotionEvent.ACTION_UP:                        shareIV.setImageResource(R.drawable.small_gray_kopie);                        shareTV.setVisibility(View.GONE);                        long diff = System.currentTimeMillis() - down;                        if (diff < 150) {                            postlink = SHARE_POST_LINK + product.getId();                            ShareDialog dialog = new ShareDialog(mContext,                                    product.getProductimageurl(), postlink);                            dialog.show();                            dialog.setOnDismissListener(new DialogInterface.OnDismissListener() {                                @Override                                public void onDismiss(DialogInterface dialogInterface) {                                    shareIV.setImageResource(R.drawable.small_gray_kopie);                                }                            });                        }                        break;                }                return false;            }        });        storeTV = (TextView) mainView.findViewById(R.id.storeTV);        storeTV.setTypeface(FontUtility.setMontserratLight(mContext));        storeIV.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                switch (motionEvent.getAction()) {                    case MotionEvent.ACTION_DOWN:                        storeIV.setImageResource(R.drawable.sitegreen);                        storeTV.setVisibility(View.VISIBLE);                        down = System.currentTimeMillis();                        break;                    case MotionEvent.ACTION_UP:                        storeIV.setImageResource(R.drawable.small_gray_store);                        storeTV.setVisibility(View.GONE);                        long diff = System.currentTimeMillis() - down;                        if (diff < 150) {                            Intent intent = new Intent(mContext, ProductDetailWebViewActivity.class);                            intent.putExtra("data", new Gson().toJson(product));                            Log.e(TAG, product.getProducturl());                            mContext.startActivity(intent);                        }                        break;                }                return false;            }        });        LikeRL.setVisibility(View.GONE);        reviewRL.setVisibility(View.GONE);        checkoutRL.setVisibility(View.GONE);        shareRL.setVisibility(View.GONE);        storeRL.setVisibility(View.GONE);        button1 = (TextView) mainView.findViewById(R.id.button1);        button1.setTypeface(FontUtility.setMontserratLight(mContext));        button1.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                choseExisitng = false;                cancel_layout1.setVisibility(View.VISIBLE);                cancel_layout2.setVisibility(View.GONE);                addProducts.setVisibility(View.INVISIBLE);                addProducts.setText("Add Product");                nameYourCollection.setVisibility(View.VISIBLE);                newCollectionName.setVisibility(View.GONE);                nameYourCollection.requestFocus();                addCollectionLayout1.setVisibility(View.GONE);                addCollectionLayout2.setVisibility(View.VISIBLE);                squareCheck2.setVisibility(View.GONE);                nameYourCollection.setVisibility(View.VISIBLE);                collectionName.setVisibility(View.GONE);                addProducts.setText("Add Product");                productInflaterLayout.removeAllViews();                products.clear();                nameYourCollection.setText("");                collection_id = null;            }        });        button2 = (TextView) mainView.findViewById(R.id.button2);        button2.setTypeface(FontUtility.setMontserratLight(mContext));        textOR = (TextView) mainView.findViewById(R.id.textOR);        textOR.setTypeface(FontUtility.setMontserratLight(mContext));        brandName = (TextView) mainView.findViewById(R.id.brandName);        brandName.setTypeface(FontUtility.setMontserratLight(mContext));        floatBrand = (TextView) mainView.findViewById(R.id.floatBrand);        floatBrand.setTypeface(FontUtility.setMontserratLight(mContext));        floatPrice = (TextView) mainView.findViewById(R.id.floatPrice);        floatPrice.setTypeface(FontUtility.setMontserratLight(mContext));        addProducts = (TextView) mainView.findViewById(R.id.add_products_button);        addProducts.setTypeface(FontUtility.setMontserratLight(mContext));        collectionName = (TextView) mainView.findViewById(R.id.collection_name_text);        collectionName.setTypeface(FontUtility.setMontserratLight(mContext));        newCollectionName = (TextView) mainView.findViewById(R.id.new_collection_name);        newCollectionName.setTypeface(FontUtility.setMontserratLight(mContext));        nameYourCollection = (EditText) mainView.findViewById(R.id.create_collection_text);        nameYourCollection.setTypeface(FontUtility.setMontserratLight(mContext));        nameYourCollection.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View v, MotionEvent event) {                if (MotionEvent.ACTION_DOWN == event.getAction()) {                    nameYourCollection.setCursorVisible(true);                }                return false;            }        });        nameYourCollection.setOnEditorActionListener(new TextView.OnEditorActionListener() {            @Override            public boolean onEditorAction(TextView textView, int i, KeyEvent keyEvent) {                if (keyEvent.getKeyCode() == KeyEvent.KEYCODE_ENTER) {                    if (validCollectionName()) {                        checkLayout.setVisibility(View.GONE);                        cancel_layout1.setVisibility(View.VISIBLE);                        nameYourCollection.setCursorVisible(false);                        nameYourCollection.setVisibility(View.GONE);                        newCollectionName.setVisibility(View.VISIBLE);                        newCollectionName.setText(finalNewCollectionName);                        addProducts.setVisibility(View.VISIBLE);                        overflow1.getFocus();                    } else                        AlertUtils.showToast(mContext, "Please enter collection name");                    return true;                }                return false;            }        });        squareCheck = (ImageView) mainView.findViewById(R.id.square_check);        squareCheck.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                imm.hideSoftInputFromWindow(nameYourCollection.getApplicationWindowToken(), 0);                nameYourCollection.setCursorVisible(false);                if (validCollectionName() && addProducts.getVisibility() == View.INVISIBLE) {                    addProducts.setVisibility(View.VISIBLE);                    nameYourCollection.setVisibility(View.GONE);                    newCollectionName.setVisibility(View.VISIBLE);                    newCollectionName.setText(finalNewCollectionName);                    squareCheck.setVisibility(View.GONE);                    cancel_layout1.setVisibility(View.VISIBLE);                    productInflaterLayout.setVisibility(View.VISIBLE);                    overflow1.getFocus();                } else if (validCollectionName() && addProducts.getVisibility() == View.VISIBLE) {                    if (products.size() == 1 && validCollectionName()) {                        checkLayout.setVisibility(View.VISIBLE);                        squareCheck.setImageResource(R.drawable.square_check);                        addCollection();                    }                    overflow1.getFocus();                } else                    AlertUtils.showToast(mContext, "Please enter collection name");            }        });        squareCheck2 = (ImageView) mainView.findViewById(R.id.square_check2);        squareCheck2.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                squareCheck2.setVisibility(View.GONE);                cancel_layout1.setVisibility(View.GONE);                cancel_layout2.setVisibility(View.VISIBLE);                if (index == 1) {                    addProductInCollection(collection_id, product);                } else {                    removeProductInCollection(collection_id, product);                }            }        });        nameYourCollection.setOnFocusChangeListener(new View.OnFocusChangeListener() {            @Override            public void onFocusChange(View view, boolean hasFocus) {                if (hasFocus) {                    overflow1.getFocus();                } else {                    overflow1.loseFocus();                }            }        });        CollectionTextWatcher watcher = new CollectionTextWatcher();        nameYourCollection.addTextChangedListener(watcher);        overflow1 = (MyMaterialContentOverflow2) mainView.findViewById(R.id.overflow1);        button2 = (TextView) mainView.findViewById(R.id.button2);        button2.setTypeface(FontUtility.setMontserratLight(mContext));        text1 = (TextView) mainView.findViewById(R.id.text1);        text1.setTypeface(FontUtility.setMontserratLight(mContext));        text2 = (TextView) mainView.findViewById(R.id.text2);        text2.setTypeface(FontUtility.setMontserratLight(mContext));        text7_2 = (TextView) mainView.findViewById(R.id.text7_2);        text7_2.setTypeface(FontUtility.setMontserratLight(mContext));        spinner1 = (Spinner) mainView.findViewById(R.id.spinner1);        ArrayList<String> list3 = new ArrayList<String>();        list3.add("Quantity");        list3.add("1");        list3.add("2");        list3.add("3");        list3.add("4");        list3.add("5");        list3.add("6");        list3.add("7");        list3.add("8");        list3.add("9");        list3.add("10");        ArrayAdapter adapter3 =                new ArrayAdapter<String>(mContext, R.layout.myspinneritem, list3) {                    @Override                    public View getView(int position, View convertView, ViewGroup parent) {                        View view = super.getView(position, convertView, parent);                        ((TextView) view).setTypeface(FontUtility.setMontserratLight(mContext));                        return view;                    }                    public View getDropDownView(int position, View convertView, ViewGroup parent) {                        View view = super.getDropDownView(position, convertView, parent);                        ((TextView) view).setTypeface(FontUtility.setMontserratLight(mContext));                        return view;                    }                };        adapter3.setDropDownViewResource(R.layout.myspinnerdropdown);        spinner1.setAdapter(adapter3);        spinner1.setSelection(0);        text6 = (TextView) mainView.findViewById(R.id.text6);        text6.setTypeface(FontUtility.setMontserratLight(mContext));        text6.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                addProductToCart(product);            }        });        spinner1.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {                if (validSpinnerChoice() && !still_processing) {                    text6.setBackgroundResource(R.drawable.flatlayloginbordernew7);                }                validAddToCart();            }            public void onNothingSelected(AdapterView<?> parent) {                validAddToCart();            }        });        text7 = (TextView) mainView.findViewById(R.id.text7);        text7.setTypeface(FontUtility.setMontserratLight(mContext));        text7.setMaxLines(3);        text9 = (TextView) mainView.findViewById(R.id.text9);        text9.setTypeface(FontUtility.setMontserratRegular(mContext));        text8 = (TextView) mainView.findViewById(R.id.text8);        text8.setTypeface(FontUtility.setMontserratLight(mContext));        text8.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                overflow1.setOpen();                if (text8.getText().toString().trim().equals("View More")) {                    text7.setMaxLines(Integer.MAX_VALUE);                    text7.setVisibility(View.GONE);                    scroll_text7.setVisibility(View.VISIBLE);                    text8.setText("View Less");                    overflow1.setOpen();                } else {                    text7.setMaxLines(3);                    text7.setVisibility(View.VISIBLE);                    scroll_text7.setVisibility(View.GONE);                    text8.setText("View More");                    overflow1.setOpen();                }            }        });        cartImg.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                overflow1.triggerSlide();            }        });    }    @Override    public void refreshData(Bundle bundle) {    }    @Override    public void setClickListener() {        likeIV.setOnClickListener(this);        reviewIV.setOnClickListener(this);        checkoutIV.setOnClickListener(this);        storeIV.setOnClickListener(this);        shareIV.setOnClickListener(this);        cancelIcon.setOnClickListener(this);        cancelImage.setOnClickListener(this);        backIconLayout.setOnClickListener(this);        button2.setOnClickListener(this);        addProducts.setOnClickListener(this);    }    public void getStatus(final String cart_id) {        TwoTapApi twoTapApi = new TwoTapApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                try {                    JSONObject object2 = new JSONObject(object.toString());                    String message = object2.getString("message");                    if (message.equalsIgnoreCase("has_failures")) {                        isProductExist = false;                        still_processing = false;                    } else if (message.equalsIgnoreCase("done")) {                        isProductExist = true;                        still_processing = false;                        getData(object);                    } else {                        getStatus(cart_id);                    }                } catch (Exception e) {                    e.printStackTrace();                }            }            @Override            public void handleOnFailure(ServiceException exception, Object object) {            }        });        twoTapApi.getCartStatus(cart_id);        twoTapApi.execute();    }    private String description = "";    public void getData(Object object) {        List<JSONObject> list = new ArrayList<JSONObject>();        try {            JSONObject jsonObject = new JSONObject(object.toString());            JSONObject sites;            try {                sites = jsonObject.getJSONObject("sites");                Iterator keys = sites.keys();                while (keys.hasNext()) {                    String currentDynamicKey = (String) keys.next();                    JSONObject currentDynamicValue = sites.getJSONObject(currentDynamicKey);                    JSONObject add_to_cart = null;                    JSONObject failed_to_add_to_cart = null;                    try {                        add_to_cart = currentDynamicValue.getJSONObject("add_to_cart");                        Iterator data = add_to_cart.keys();                        while (data.hasNext()) {                            String currentKey = (String) data.next();                            JSONObject value = add_to_cart.getJSONObject(currentKey);                            description = value.getString("description");                            if (value.has("alt_images")) {                                JSONArray alt_images = value.getJSONArray("alt_images");                                for (int i = 0; i < alt_images.length(); i++) {                                    productMultipleImages.add(alt_images.getString(i));                                    mAdapter.notifyDataSetChanged();                                }                            } else if (value.has("image")) {                                productMultipleImages.add(value.getString("image"));                                mAdapter.notifyDataSetChanged();                            }                            try {                                if (value.getString("status").equals("still_processing")) {                                    list.clear();                                    getStatus(cartid);                                } else {                                    value.put("site_id", currentDynamicKey);                                    value.put("md5", currentKey);                                    list.add(value);                                }                            } catch (Exception e) {                                e.printStackTrace();                                list.clear();                                getStatus(cartid);                            }                        }                    } catch (Exception e) {                        e.printStackTrace();                        failed_to_add_to_cart = currentDynamicValue.getJSONObject("failed_to_add_to_cart");                        Iterator data = failed_to_add_to_cart.keys();                        while (data.hasNext()) {                            String currentKey = (String) data.next();                            JSONObject value = failed_to_add_to_cart.getJSONObject(currentKey);                            setFailedProduct();                        }                        e.printStackTrace();                    }                }                try {                    JSONArray array = jsonObject.getJSONArray("unknown_urls");                    for (int i = 0; i < array.length(); i++) {                        String url = array.getString(i);                        setFailedProduct();                    }                } catch (Exception e) {                    e.printStackTrace();                }            } catch (Exception e1) {                e1.printStackTrace();            }        } catch (JSONException e) {            e.printStackTrace();        }        fetchData(list);    }    private void fetchData(List<JSONObject> list) {        for (int i = 0; i < list.size(); i++) {            TwoTapProductDetails product = new TwoTapProductDetails();            if (list.get(i) != null) {                JSONObject value = list.get(i);                try {                    product.setOriginal_url(value.getString("original_url"));                } catch (JSONException e3) {                    e3.printStackTrace();                }                try {                    product.setSiteId(value.getString("site_id"));                    product.setMd5(value.getString("md5"));                    product.setUrl(value.getString("url"));                } catch (Exception e) {                    e.printStackTrace();                }                try {                    JSONArray arr = value.getJSONArray("required_field_names");                    List<ProductRequiredOption> requiredOptionList = new ArrayList<>();                    for (int j = 0; j < arr.length(); j++) {                        ProductRequiredOption requiredOption = new ProductRequiredOption();                        requiredOption.setName(arr.getString(j));                        requiredOptionList.add(requiredOption);                    }                    product.setRequiredOptionList(requiredOptionList);                    JSONObject required_field_values = value.getJSONObject("required_field_values");                    product.setProductMainOptionList(getMainOptionList(required_field_values));                    setNewOption(product.getProductMainOptionList());                } catch (Exception e) {                    e.printStackTrace();                }            }            productDetails.add(product);        }        List<String> productToSelectDetail = new ArrayList<String>();        for (int i = 0; i < productDetails.size(); i++) {            List<ProductRequiredOption> list2 = productDetails.get(i).getRequiredOptionList();            if (list2.size() > 1) {  //assuming that quantity will always present so size should be > 1 for selection.                productToSelectDetail.add(productDetails.get(i).getOriginal_url());            } else {                setNoDetailsProduct();            }        }        for (int i = 0; i < productDetails.size(); i++) {            for (int j = 0; j < productLists.size(); j++) {                if (productDetails.get(i).getOriginal_url().equals(productLists.get(j).getProducturl())) {                    productLists.get(j).setProductMainOptionList(productDetails.get(i).getProductMainOptionList());                    productLists.get(j).setSiteId(productDetails.get(i).getSiteId());                    productLists.get(j).setMd5(productDetails.get(i).getMd5());                    productLists.get(j).setUrl(productDetails.get(i).getUrl());                }            }        }    }    private List<ProductMainOption> getMainOptionList(JSONObject optJSONObject) {        Iterator data = optJSONObject.keys();        List<ProductMainOption> productMainOptionList = new ArrayList<>();        try {            while (data.hasNext()) {                String currentKey = (String) data.next();                ProductMainOption mainOption = new ProductMainOption();                JSONArray mainOptionArray = optJSONObject.getJSONArray(currentKey);                mainOption.setName(currentKey);                List<ProductChildOption> optionList = new ArrayList<>();                for (int j = 0; j < mainOptionArray.length(); j++) {                    ProductChildOption childOption = new ProductChildOption();                    JSONObject option = mainOptionArray.getJSONObject(j);                    childOption.setExtra_info(option.optString("extra_info"));                    childOption.setImage(option.optString("image"));                    childOption.setPrice(option.optString("price"));                    childOption.setText(option.optString("text"));                    childOption.setValue(option.optString("value"));                    childOption.setDep(getMainOptionList(option.optJSONObject("dep")));                    optionList.add(childOption);                }                mainOption.setOptionList(optionList);                productMainOptionList.add(mainOption);            }        } catch (Exception e) {            e.printStackTrace();        }        return productMainOptionList;    }    private boolean isReloadData = true;    private HashMap<String, Boolean> firstTimeOptionMap = new HashMap<>();    private void setNewOption(List<ProductMainOption> mainOptions) {        LayoutInflater inflater = (LayoutInflater) mContext.getSystemService(Context.LAYOUT_INFLATER_SERVICE);        for (int i = 0; i < mainOptions.size(); i++) {            final ProductMainOption mainOption = mainOptions.get(i);            //////////////////////////////////////////////////////change            View v = inflater.inflate(R.layout.edit_product_item,spinner_layout,false);            Spinner s = (Spinner) v.findViewById(R.id.spinner1);            ArrayList<String> list3 = new ArrayList<String>();            list3.add(StringUtils.FirstLetterInUpperCase(mainOption.getName()));            List<ProductChildOption> optionList = mainOption.getOptionList();            int size = optionList.size();            for (int m = 0; m < size; m++) {                list3.add(StringUtils.FirstLetterInUpperCase(optionList.get(m).getText()));            }            ArrayAdapter adapter3 =                    new ArrayAdapter<String>(mContext, R.layout.myspinneritem, list3) {                        @Override                        public View getView(int position, View convertView, ViewGroup parent) {                            View view = super.getView(position, convertView, parent);                            ((TextView) view).setTypeface(FontUtility.setMontserratLight(mContext));                            return view;                        }                        public View getDropDownView(int position, View convertView, ViewGroup parent) {                            View view = super.getDropDownView(position, convertView, parent);                            ((TextView) view).setTypeface(FontUtility.setMontserratLight(mContext));                            return view;                        }                    };            adapter3.setDropDownViewResource(R.layout.myspinnerdropdown);            s.setAdapter(adapter3);            ViewGroup.MarginLayoutParams params =                    (ViewGroup.MarginLayoutParams) s.getLayoutParams();            params.setMargins(0, 20, 0, 0);            s.setLayoutParams(params);            s.setSelection(0);            s.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {                public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {                    String choice = adapterView.getSelectedItem().toString();                    if (!firstTimeOptionMap.containsKey(choice)) {                        firstTimeOptionMap.put(choice, false);                        for (int k = 0; k < mainOption.getOptionList().size(); k++) {                            if (mainOption.getOptionList().get(k).getText().equalsIgnoreCase(choice)) {                                addOption(mainOption.getOptionList().get(k));                            }                        }                    }                    if (validSpinnerChoice() && !still_processing) {                        text6.setBackgroundResource(R.drawable.flatlayloginbordernew7);                    }                    validAddToCart();                }                public void onNothingSelected(AdapterView<?> adapterView) {                    validAddToCart();                }            });            spinner_layout.addView(v);            spinnerNameMap.put(s, StringUtils.FirstLetterInUpperCase(mainOption.getName()));        }    }    public void addOption(ProductChildOption child) {        if (child != null && child.getDep() != null && child.getDep().size() > 0) {            List<ProductMainOption> mainOptions = child.getDep();            setNewOption(mainOptions);        }    }    private void setFailedProduct() {        isProductExist = false;    }    private void setNoDetailsProduct() {        isProductExist = true;    }    private void getCartId() {        TwoTapApi twoTapApi = new TwoTapApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                try {                    if (object != null) {                        JSONObject jsonObject = new JSONObject(object.toString());                        cartid = (String) jsonObject.get("cart_id");                        getStatus(cartid);                    }                } catch (JSONException e) {                    e.printStackTrace();                }            }            @Override            public void handleOnFailure(ServiceException exception, Object object) {            }        });        List<String> products = new ArrayList<String>();        products.add(product.getProducturl());        twoTapApi.getCartId(products);        twoTapApi.execute();    }    @Override    public void setData(Bundle bundle) {        product = (Product) bundle.getSerializable("data");        productLists.add(product);        double productPrice = Double.parseDouble(product.getRetailprice());        if (!TextUtils.isEmpty(product.getSaleprice()) && !product.getSaleprice().equals("0")                && !product.getSaleprice().equals(product.getRetailprice())) {            productPrice = Double.parseDouble(product.getSaleprice());        }        com.google.android.gms.analytics.ecommerce.Product prod =                new com.google.android.gms.analytics.ecommerce.Product()                        .setId(product.getId())                        .setName(product.getProductname())                        .setCategory(product.getPrimarycategory())                        .setPrice(productPrice);        HitBuilders.ScreenViewBuilder builder = new HitBuilders.ScreenViewBuilder()                .addImpression(prod, "Product Impression");        Tracker t = ((KikrApp) mContext.getApplication()).getTracker(KikrApp.TrackerName.APP_TRACKER);        t.setScreenName("Discover Detail");        t.send(builder.build());        text7.setText(getDescription());        text7_2.setText(getDescription());        brandName.setText(product.getMerchantname());        floatBrand.setText(product.getMerchantname());        floatPrice.setText("$" + new DecimalFormat("#,##0.00").format(new Double(productPrice)));        setDetails();    }    private CharSequence getDescription() {        int sDescLength = product.getShortproductdesc().length();        int lDescpLength = product.getLongproductdesc().length();        if (sDescLength != 0 && lDescpLength != 0) {            return sDescLength < lDescpLength ? product.getShortproductdesc() :                    product.getLongproductdesc();        } else {            return lDescpLength == 0 ? product.getShortproductdesc() : product.getLongproductdesc();        }    }    private void setDetails() {        productMultipleImages.add(product.getProductimageurl());        getCartId();        mAdapter = new ProductImageAdapter(mContext, productMultipleImages, product.getProducturl(),                product);        productImageView.setAdapter(mAdapter);        indicator.setViewPager(productImageView);    }    private void startAnimation() {        int width = img1.getWidth();        LikeRL.setVisibility(View.VISIBLE);        startLikeArcAnimation(-(float) (width * 1.2), 0);        reviewRL.setVisibility(View.VISIBLE);        startDisArcAnimation(-(float) (width * 0.8), -(float) (width * 0.8));        checkoutRL.setVisibility(View.VISIBLE);        startCheckArcAnimation(0, -(float) (width * 1.2));        storeRL.setVisibility(View.VISIBLE);        startStoreArcAnimation((float) (width * 0.9), -(float) (width * 0.8));        shareRL.setVisibility(View.VISIBLE);        startShareArcAnimation((float) (width * 1.3), 0);    }    private void startLikeArcAnimation(float toX, float toY) {        ObjectAnimator translationLeft = ObjectAnimator.ofFloat(LikeRL, "X",                img1.getX(), toX);        translationLeft.setDuration(500);        translationLeft.start();        isFirstTime = false;    }    private void startDisArcAnimation(float toX, float toY) {        AnimatorSet animatorSet = new AnimatorSet();        ObjectAnimator translationLeft = ObjectAnimator.ofFloat(reviewRL, "X", img1.getX(), toX);        ObjectAnimator translationUp = ObjectAnimator.ofFloat(reviewRL, "Y", img1.getY(), toY);        animatorSet.setDuration(500);        animatorSet.playTogether(translationLeft, translationUp);        animatorSet.start();    }    private void startCheckArcAnimation(float toX, float toY) {        ObjectAnimator translationUp = ObjectAnimator.ofFloat(checkoutRL, "Y",                img1.getY(), toY);        translationUp.setDuration(500);        translationUp.start();    }    private void startStoreArcAnimation(float toX, float toY) {        AnimatorSet animatorSet = new AnimatorSet();        ObjectAnimator translationRight = ObjectAnimator.ofFloat(storeRL, "X", img1.getX(), toX);        ObjectAnimator translationUp = ObjectAnimator.ofFloat(storeRL, "Y", img1.getY(), toY);        animatorSet.setDuration(500);        animatorSet.playTogether(translationRight, translationUp);        animatorSet.start();    }    private void startShareArcAnimation(float toX, float toY) {        ObjectAnimator translationRight = ObjectAnimator.ofFloat(shareRL, "X",                img1.getX(), toX);        translationRight.setDuration(500);        translationRight.start();    }    public boolean validSpinnerChoice() {        for (Map.Entry<Spinner, String> entry : spinnerNameMap.entrySet()) {            if (entry.getKey().getSelectedItem().toString().equalsIgnoreCase(entry.getValue())) {                return false;            }        }        return true;    }    public void validAddToCart() {        quantity = spinner1.getSelectedItem().toString().trim();        if (quantity.equalsIgnoreCase("Quantity")) {            spinner1.setBackgroundResource(R.drawable.btn_whitebg_red_stroke);            spinner1.startAnimation(shake);            text6.setBackgroundResource(R.drawable.btn_graybg);        } else {            spinner1.setBackgroundResource(R.drawable.btn_whitebg);        }        for (Map.Entry<Spinner, String> entry : spinnerNameMap.entrySet()) {            Spinner current = entry.getKey();            if (current.getSelectedItem().toString().trim().equalsIgnoreCase(entry.getValue())) {                current.setBackgroundResource(R.drawable.btn_whitebg_red_stroke);                current.startAnimation(shake);                text6.setBackgroundResource(R.drawable.btn_graybg);            } else {                current.setBackgroundResource(R.drawable.btn_whitebg);            }        }    }    public boolean validAddToCartWithToast() {        quantity = spinner1.getSelectedItem().toString().trim();        if (quantity.equals("Quantity")) {            AlertUtils.showToast(mContext, "Please select quantity");            spinner1.setBackgroundResource(R.drawable.btn_whitebg_red_stroke);            spinner1.startAnimation(shake);            text6.setBackgroundResource(R.drawable.btn_graybg);            return false;        } else {            spinner1.setBackgroundResource(R.drawable.btn_whitebg);        }        for (Map.Entry<Spinner, String> entry : spinnerNameMap.entrySet()) {            Spinner current = entry.getKey();            if (current.getSelectedItem().toString().trim().equalsIgnoreCase(entry.getValue())) {                AlertUtils.showToast(mContext, "Please select " + entry.getValue());                current.setBackgroundResource(R.drawable.btn_whitebg_red_stroke);                current.startAnimation(shake);                text6.setBackgroundResource(R.drawable.btn_graybg);                return false;            } else {                current.setBackgroundResource(R.drawable.btn_whitebg);                if (entry.getValue().equalsIgnoreCase("color")) {                    color = current.getSelectedItem().toString().trim();                    product.setColor(color);                } else if (entry.getValue().equalsIgnoreCase("size")) {                    size = current.getSelectedItem().toString().trim();                    product.setSize(size);                }            }        }        return true;    }    public void addProductToCart(Product product) {        if (still_processing) {            AlertUtils.showToast(mContext, "Please wait, still processing product data.");            return;        }        if (!isProductExist) {            AlertUtils.showToast(mContext, "Product is not available");            return;        }        if (!validAddToCartWithToast()) {            validAddToCart();            return;        }        final CartApi cartApi = new CartApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                if (object != null) {                    UserPreference.getInstance().incCartCount();                    ((HomeActivity) mContext).refreshCartCount();                    AlertUtils.showToast(mContext, "Added to cart");                    checkoutIV.setImageResource(R.drawable.small_gray_cart);                }            }            @Override            public void handleOnFailure(ServiceException exception,                                        Object object) {                Syso.info("In handleOnFailure>>" + object);                if (object != null) {                    CartRes response = (CartRes) object;                    AlertUtils.showToast(mContext, response.getMessage());                } else {                    AlertUtils.showToast(mContext, R.string.invalid_response);                    checkoutIV.setImageResource(R.drawable.small_gray_cart);                }            }        });        String fromUserId = product.getFrom_user_id() == null ? "" : product.getFrom_user_id();        String fromCollection = product.getFrom_collection_id() == null ? "" :                product.getFrom_collection_id();        cartApi.addToCart(UserPreference.getInstance().getUserID(), product.getId(), quantity,                UserPreference.getInstance().getCartID(), fromUserId, fromCollection, size, color, productLists.get(0).getSelected_values());        cartApi.execute();    }    private void addProductInCollection(String collection_id, Product product) {        String from_user_id = TextUtils.isEmpty(product.getFrom_user_id()) ? "" :                product.getFrom_user_id();        String from_collection_id = TextUtils.isEmpty(product.getFrom_collection_id()) ? "" :                product.getFrom_collection_id();        final CollectionApi collectionApi = new CollectionApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                CollectionApiRes collectionApiRes = (CollectionApiRes) object;                AlertUtils.showToast(mContext, collectionApiRes.getMessage());                checkLayout.setVisibility(View.GONE);                cancel_layout1.setVisibility(View.GONE);                cancel_layout2.setVisibility(View.VISIBLE);            }            @Override            public void handleOnFailure(ServiceException exception, Object object) {                if (object != null) {                    CollectionApiRes response = (CollectionApiRes) object;                    AlertUtils.showToast(mContext, response.getMessage());                } else {                    AlertUtils.showToast(mContext, R.string.invalid_response);                }            }        });        collectionApi.addProductInCollection(UserPreference.getInstance().getUserID(),                collection_id, product.getId(), from_user_id, from_collection_id,                product.getProductimageurl());        collectionApi.execute();    }    private void removeProductInCollection(String collection_id, Product product) {        final CollectionApi collectionApi = new CollectionApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                AlertUtils.showToast(mContext, "Product removed");                checkLayout.setVisibility(View.GONE);                cancel_layout2.setVisibility(View.VISIBLE);                cancel_layout1.setVisibility(View.GONE);            }            @Override            public void handleOnFailure(ServiceException exception, Object object) {                if (object != null) {                    CollectionApiRes response = (CollectionApiRes) object;                    AlertUtils.showToast(mContext, "No change made");                } else {                    AlertUtils.showToast(mContext, R.string.invalid_response);                }            }        });        collectionApi.deleteProductFromCollection(UserPreference.getInstance().getUserID(),                collection_id, product.getId());        collectionApi.execute();    }    public boolean validCollectionName() {        String name = nameYourCollection.getText().toString();        if (name != null && name.length() != 0) {            finalNewCollectionName = name.trim();            return true;        }        return false;    }    private class CollectionTextWatcher implements TextWatcher {        @Override        public void beforeTextChanged(CharSequence charSequence, int i, int i1, int i2) {        }        @Override        public void onTextChanged(CharSequence charSequence, int i, int i1, int i2) {            if (validCollectionName()) {                cancel_layout2.setVisibility(View.GONE);                cancel_layout1.setVisibility(View.GONE);                checkLayout.setVisibility(View.VISIBLE);                squareCheck.setVisibility(View.VISIBLE);                squareCheck.setImageResource(R.drawable.square_check);            } else {                checkLayout.setVisibility(View.GONE);                cancel_layout2.setVisibility(View.GONE);                cancel_layout1.setVisibility(View.VISIBLE);            }        }        @Override        public void afterTextChanged(Editable editable) {        }    }    private void addCollection() {        final AddCollectionApi collectionApi = new AddCollectionApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                AlertUtils.showToast(mContext, "Collection added");                nameYourCollection.clearFocus();                getNewCollectionId();            }            @Override            public void handleOnFailure(ServiceException exception, Object object) {            }        });        if (finalNewCollectionName != null && finalNewCollectionName.length() > 0)            collectionApi.addNewCollection(finalNewCollectionName);        collectionApi.execute();    }    private void updateListAdd() {        products.add(0, product);        index = 1;        addProducts.setText("Remove Product");        productInflaterLayout.removeAllViews();        productInflaterLayout.addView(new ProductUI(mContext, 200, 200, products, false).getView());    }    private void updateListRemove() {        index = 0;        addProducts.setText("Add Product");        int size = products.size();        for (int i = 0; i < size; i++) {            if (products.get(i).getId().equals(product.getId())) {                products.remove(products.get(i));                break;            }        }        productInflaterLayout.removeAllViews();        productInflaterLayout.addView(new ProductUI(mContext, 200, 200, products, false).getView());    }    public void getNewCollectionId() {        final CollectionApi collectionApi = new CollectionApi(new ServiceCallback() {            @Override            public void handleOnSuccess(Object object) {                CollectionApiRes collectionApiRes = (CollectionApiRes) object;                collectionLists = collectionApiRes.getCollection();                if (collectionLists != null && collectionLists.size() > 0) {                    collection_id = collectionLists.get(collectionLists.size() - 1).getId();                    if (products.size() == 1)                        addProductInCollection(collection_id, product);                    checkLayout.setVisibility(View.GONE);                    cancel_layout1.setVisibility(View.GONE);                    cancel_layout2.setVisibility(View.VISIBLE);                    addProducts.setVisibility(View.INVISIBLE);                    newCollectionName.setText(collectionLists.get(collectionLists.size() - 1).getName());                }            }            @Override            public void handleOnFailure(ServiceException exception, Object object) {                if (object != null) {                    CollectionApiRes response = (CollectionApiRes) object;                    AlertUtils.showToast(mContext, response.getMessage());                } else {                    AlertUtils.showToast(mContext, R.string.invalid_response);                }            }        });        collectionApi.getCollectionList(UserPreference.getInstance().getUserID());        collectionApi.execute();    }}